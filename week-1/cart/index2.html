<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Giỏ Hàng Đơn Giản</title>
    </head>
    <body>

        <h3>Thêm sản phẩm mới</h3>
        <input type="text" id="product-name" placeholder="Tên sản phẩm">
        <input type="number" id="product-price" placeholder="Giá sản phẩm">
        <button id="add-product">Thêm sản phẩm</button>

        <h2>Danh sách sản phẩm</h2>
        <input type="text" id="search-input" placeholder="Tìm kiếm sản phẩm...">
        <button id="sort-asc">Sắp xếp tăng dần</button>
        <button id="sort-desc">Sắp xếp giảm dần</button>
        <ul id="product-list"></ul>

        <hr />

        <h2>Giỏ hàng</h2>
        <ul id="cart-list"></ul>
        <hr>
        <h2>Tổng tiền: <strong id="total">0</strong></h2>
        <script>
    
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const products = [
      { id: 1, name: "Chuột Logitech", price: 350000 },
      { id: 2, name: "Bàn phím cơ DareU", price: 650000 },
      { id: 3, name: "Tai nghe Gaming", price: 450000 },
    ];
   
    function renderProductList(productArray = products){
        const productList = document.getElementById('product-list');
        productList.innerHTML ="";
        productArray.forEach(product => {
            const li = document.createElement('li');
            const btnAddCart = document.createElement('button');
            btnAddCart.textContent = "Add cart";
            li.textContent = `${product.name} - ${product.price}`;
            btnAddCart.addEventListener('click',function(){
                addToCart(product);
            })
            li.appendChild(btnAddCart);
            productList.appendChild(li);
        });
    }

    // sap xep tang dan
    document.getElementById('sort-asc').addEventListener('click',function(){
        products.sort((a,b)=>a.price - b.price);
        renderProductList();
    });
     document.getElementById('sort-desc').addEventListener('click',function(){
        products.sort((a,b)=>b.price - a.price);
        renderProductList();
    });


    // them sản phẩm mới
    function addNewProduct(){
        const addProduct = document.getElementById('add-product');
        addProduct.addEventListener('click',function(e){
            const name = document.getElementById('product-name').value.trim();
            const price = parseInt(document.getElementById('product-price').value);
           if(!name || isNaN(price) || price <=0 ){
                alert('Ban phai nhap san pham hop le');
           }else{
                const newProduct = {
                    id: Date.now(),
                    name: name,
                    price: price
                }
                products.push(newProduct);
               
                
           }
           renderProductList();
          document.getElementById('product-name').value = '';
          document.getElementById('product-price').value = '';
        });
    }
    addNewProduct();


    // search product
    function searchProduct(){
        const searchInput = document.querySelector('#search-input');
        searchInput.addEventListener('input',function(){
            const keyword = this.value.toLowerCase();
            const filterProduct = products.filter(product => {
                return product.name.toLowerCase().includes(keyword);
        });

            renderProductList(filterProduct);
        })
    }
    searchProduct();


    function addToCart(product){

        const index = cart.findIndex(item => item.id === product.id);

        if(index !== -1){
            cart[index].quantity += 1;
        }else{
            cart.push({...product,quantity:1});
        }

        renderCart();
    }

    function renderCart(){
        const cartList = document.getElementById('cart-list');
        const total = document.querySelector('#total');
        cartList.innerHTML = '';
        let totalCart = 0;
        cart.forEach(item=> {
            const li = document.createElement('li');
            const btnRemoveCart = document.createElement('button');
            const btnIncrease = document.createElement('button');
            const btnDecrease = document.createElement('button');
            btnIncrease.textContent = "+";
            btnDecrease.textContent = "-";

            btnRemoveCart.textContent = "Xóa";
            let totalItem = item.quantity * item.price;
            li.textContent = `${item.name} - ${item.price} x ${item.quantity} = ${totalItem.toLocaleString()}`;
            
            // tang so luong
            btnIncrease.addEventListener('click',function(e){
                e.preventDefault();
                increaseQuantity(item.id);   
            });

            // giam so luong
            btnDecrease.addEventListener('click',function(e){
                e.preventDefault();
                decreaseQuantity(item.id);
            })


            btnRemoveCart.addEventListener('click',function(e){
                e.preventDefault();
                const isConfirmed = confirm('Ban có muốn xóa san pham ra khỏi giỏ hàng');
                if(isConfirmed){
                    removeFromCart(item.id);
                }

            })
            totalCart += totalItem;
            li.appendChild(btnIncrease);
            li.appendChild(btnDecrease);
            li.appendChild(btnRemoveCart);
            cartList.appendChild(li);
        }); 4
        total.textContent = totalCart.toLocaleString() + "VNĐ";
        localStorage.setItem("cart",JSON.stringify(cart));    
    }
    renderCart();

    function increaseQuantity(id){
        const index = cart.findIndex(item => item.id === id);
        if(index !== -1){
            cart[index].quantity +=1;
        }
        renderCart();
        
    }

    function decreaseQuantity(id){
        const index = cart.findIndex(item => item.id === id);
        if(index !== -1){
            if(cart[index].quantity > 1){
                cart[index].quantity -= 1;
            }else {
                const isConfirmed = confirm("ban có muốn xoa khỏi giỏ hàng");
                if(isConfirmed){   
                    removeFromCart(id);
                }
            }
        }
        renderCart();
    }

    function removeFromCart(id){
        const index = cart.findIndex(item=> item.id === id);
        if(index !== -1){
            cart.splice(index,1);
        }
        renderCart();
        
    }

   
    renderProductList();
    </script>
    </body>
</html>